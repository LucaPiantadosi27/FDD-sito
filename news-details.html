<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- Title -->
    <title>FDD - Dettaglio News</title>

    <!-- Favicon -->
    <link rel="icon" href="/img/footer/LOGO_FDDsvg.svg" type="image/svg+xml">

    <!-- Core Stylesheet -->
    <link rel="stylesheet" href="/style.css">

</head>

<body>
    <!-- Preloader -->
    <div class="preloader d-flex align-items-center justify-content-center">
        <div class="preloader-circle"></div>
        <div class="preloader-img">
            <img src="/img/core-img/leaf.png" alt="">
        </div>
    </div>

    <!-- ##### Header Area Start ##### -->
    <header class="header-area">

        <!-- ***** Top Header Area ***** -->
        <div class="top-header-area">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="top-header-content d-flex align-items-center justify-content-between">
                            <!-- Top Header Content -->
                            <div class="top-header-meta">
                                <a href="#" data-toggle="tooltip" data-placement="bottom"
                                    title="sluciacoopsoc.ets@gmail.com"><i class="fa fa-envelope-o"
                                        aria-hidden="true"></i> <span>Email: sluciacoopsoc.ets@gmail.com</span></a>
                                <a href="#" data-toggle="tooltip" data-placement="bottom" title="0815391668"><i
                                        class="fa fa-phone" aria-hidden="true"></i> <span>Call Us: 0815391668</span></a>
                            </div>

                            <!-- Top Header Content -->
                            <div class="top-header-meta d-flex">
                                <div class="social-links">
                                    <a href="https://www.facebook.com/santalucia.cooperativasociale?locale=it_IT"
                                        style="display: inline-block; margin-right: 10px"><i class="fa fa-facebook"
                                            aria-hidden="true" style="color: rgb(112, 199, 69)"></i></a>
                                    <a href="https://x.com/CoopSantaLucia"
                                        style="display: inline-block; margin-right: 10px"><i class="fa fa-twitter"
                                            aria-hidden="true" style="color: rgb(112, 199, 69)"></i></a>
                                    <a href="https://maps.app.goo.gl/HAgSCAbv1Xuq8MY57"
                                        style="display: inline-block; margin-right: 10px"><i class="fa fa-google-plus"
                                            aria-hidden="true" style="color: rgb(112, 199, 69)"></i></a>
                                    <a href="https://www.instagram.com/sluciacoopsoc.ets/"
                                        style="display: inline-block; margin-right: 10px"><i class="fa fa-instagram"
                                            aria-hidden="true" style="color: rgb(112, 199, 69)"></i></a>
                                    <a href="https://www.linkedin.com/in/cooperativa-s-lucia-64bb333ab/"
                                        style="display: inline-block; margin-right: 0"><i class="fa fa-linkedin"
                                            aria-hidden="true" style="color: rgb(112, 199, 69)"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ***** Navbar Area ***** -->
        <div class="alazea-main-menu">
            <div class="classy-nav-container breakpoint-off">
                <div class="container">
                    <!-- Menu -->
                    <nav class="classy-navbar justify-content-between" id="alazeaNav">

                        <!-- Nav Brand -->
                        <a href="/index.html" class="nav-brand"><img src="/img/footer/LOGO_FDDsvg.svg" alt=""></a>

                        <!-- Navbar Toggler -->
                        <div class="classy-navbar-toggler">
                            <span class="navbarToggler"><span></span><span></span><span></span></span>
                        </div>

                        <!-- Menu -->
                        <div class="classy-menu">

                            <!-- Close Button -->
                            <div class="classycloseIcon">
                                <div class="cross-wrap"><span class="top"></span><span class="bottom"></span></div>
                            </div>

                            <!-- Navbar Start -->
                            <div class="classynav">
                                <ul>
                                    <li><a href="index.html">Home</a></li>
                                    <li><a href="index.html#funzionalita">Funzionalità</a></li>
                                    <li><a href="index.html#chi-siamo">Chi Siamo</a></li>
                                    <li><a href="index.html#scopri-app-fdd">App</a></li>
                                    <li><a href="news.html">News</a></li>
                                    <li><a href="index.html#contact-area">Contatti</a></li>
                                </ul>

                                <!-- Search Icon -->
                                <div id="searchIcon">
                                    <i class="fa fa-search" aria-hidden="true"></i>
                                </div>

                            </div>
                            <!-- Navbar End -->
                        </div>
                    </nav>

                    <!-- Search Form -->
                    <div class="search-form">
                        <form action="#" method="get">
                            <input type="search" name="search" id="search"
                                placeholder="Type keywords &amp; press enter...">
                            <button type="submit" class="d-none"></button>
                        </form>
                        <!-- Close Icon -->
                        <div class="closeIcon"><i class="fa fa-times" aria-hidden="true"></i></div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- ##### Header Area End ##### -->

    <!-- ##### Breadcrumb Area Start ##### -->
    <div class="breadcrumb-area">
        <!-- Top Breadcrumb Area -->
        <div class="top-breadcrumb-area bg-img bg-overlay d-flex align-items-center justify-content-center"
            style="background-image: url(/img/bg-img/24.jpg);">
            <h2 id="breadcrumb-title">DETTAGLIO NEWS</h2>
        </div>

        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/index.html"><i class="fa fa-home"></i> Home</a></li>
                            <li class="breadcrumb-item"><a href="/news.html">News</a></li>
                            <li class="breadcrumb-item active" aria-current="page" id="breadcrumb-active">Dettaglio</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <!-- ##### Breadcrumb Area End ##### -->

    <!-- ##### Blog Content Area Start ##### -->
    <section class="blog-content-area section-padding-0-100">
        <div class="container">
            <div class="row justify-content-center">
                <!-- Blog Posts Area -->
                <div class="col-12 col-md-10">
                    <div class="blog-posts-area">

                        <!-- Post Details Area -->
                        <div class="single-post-details-area" id="news-detail-container">
                            <div class="col-12 text-center" id="loading-spinner">
                                <div class="spinner-border text-success" role="status">
                                    <span class="sr-only">Caricamento...</span>
                                </div>
                                <p>Caricamento articolo in corso...</p>
                            </div>
                            <!-- News details will be loaded here -->
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- ##### Blog Content Area End ##### -->

    <!-- ##### Footer Area Start ##### -->
    <footer class="footer-area bg-img" style="background-image: url(/img/footer/footer-bg.jpg);">
        <!-- Main Footer Area -->
        <div class="main-footer-area">
            <div class="container">
                <div class="row">

                    <!-- Single Footer Widget -->
                    <div class="col-12 col-sm-6 col-lg-3">
                        <div class="single-footer-widget">
                            <div class="footer-logo mb-30">
                                <a href="/index.html"><img src="/img/footer/LOGO_FDDsvg.svg" alt=""></a>
                            </div>
                            <p>Fiori del Deserto: Esplora, Identifica, Gioca con la flora dei Monti Lattari.</p>
                            <div class="social-info">
                                <a href="https://www.facebook.com/santalucia.cooperativasociale?locale=it_IT"><i
                                        class="fa fa-facebook" aria-hidden="true"></i></a>
                                <a href="https://x.com/CoopSantaLucia"><i class="fa fa-twitter"
                                        aria-hidden="true"></i></a>
                                <a href="https://maps.app.goo.gl/HAgSCAbv1Xuq8MY57"><i class="fa fa-google-plus"
                                        aria-hidden="true"></i></a>
                                <a href="https://www.instagram.com/sluciacoopsoc.ets/"><i class="fa fa-instagram"
                                        aria-hidden="true"></i></a>
                                <a href="https://www.linkedin.com/in/cooperativa-s-lucia-64bb333ab/"><i
                                        class="fa fa-linkedin" aria-hidden="true"></i></a>
                            </div>
                        </div>
                    </div>

                    <!-- Single Footer Widget -->
                    <div class="col-12 col-sm-6 col-lg-3">
                        <div class="single-footer-widget">
                            <div class="widget-title">
                                <h5>QUICK LINK</h5>
                            </div>
                            <nav class="widget-nav">
                                <ul>
                                    <li><a href="/index.html">Home</a></li>
                                    <li><a href="/index.html#chi-siamo">Chi Siamo</a></li>
                                    <li><a href="/news.html">News</a></li>
                                    <li><a href="/index.html#contact-area">Contatti</a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>

                    <!-- Single Footer Widget -->
                    <div class="col-12 col-sm-6 col-lg-3">
                        <div class="single-footer-widget">
                            <div class="widget-title">
                                <h5>CONTATTI</h5>
                            </div>

                            <div class="contact-information">
                                <p><span>Indirizzo:</span> Strada ponte della persica 18E, 80053, Castellammare di
                                    Stabia, NA</p>
                                <p><span>Telefono:</span> 0815391668</p>
                                <p><span>Email:</span> sluciacoopsoc.ets@gmail.com</p>
                                <p><span>Orari:</span> Lun - Dom: 8 AM to 9 PM</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Bottom Area -->
        <div class="footer-bottom-area">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="border-line"></div>
                    </div>
                    <!-- Copywrite Text -->
                    <div class="col-12 col-md-6">
                        <div class="copywrite-text">
                            <p>&copy;
                                <script>document.write(new Date().getFullYear());</script> All rights reserved | FDD
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- ##### Footer Area End ##### -->

    <!-- ##### All Javascript Files ##### -->
    <!-- jQuery-2.2.4 js -->
    <script src="/js/jquery/jquery-2.2.4.min.js"></script>
    <!-- Popper js -->
    <script src="/js/bootstrap/popper.min.js"></script>
    <!-- Bootstrap js -->
    <script src="/js/bootstrap/bootstrap.min.js"></script>
    <!-- All Plugins js -->
    <script src="/js/plugins/plugins.js"></script>
    <!-- Config js -->
    <script src="/js/config.js"></script>
    <!-- Active js -->
    <script src="/js/active.js"></script>

    <!-- News Detail Fetching Logic -->
    <script>
        $(document).ready(function () {
            const urlParams = new URLSearchParams(window.location.search);
            let newsId = urlParams.get('id');

            console.log("Initial newsId (query):", newsId);
            console.log("Pathname:", window.location.pathname);

            // If not in query params, check the path (e.g., /1/news-details)
            if (!newsId) {
                const cleanPath = window.location.pathname.replace(/\/$/, ""); // Remove trailing slash
                const pathParts = cleanPath.split('/');

                // Find where 'news-details' is in the path
                const newsDetailsIndex = pathParts.indexOf('news-details');
                console.log("news-details index in path:", newsDetailsIndex);

                if (newsDetailsIndex > 0) {
                    newsId = pathParts[newsDetailsIndex - 1];
                }
            }

            console.log("Final newsId for API:", newsId);

            const apiUrl = window.env.API_URL;

            if (!newsId) {
                $('#news-detail-container').html('<div class="col-12 text-center"><p class="text-warning">Nessun articolo selezionato.</p><a href="news.html" class="btn alazea-btn">Torna alle News</a></div>');
                return;
            }

            $.ajax({
                url: apiUrl + "/news/" + newsId,
                type: "GET",
                success: function (response) {
                    $('#loading-spinner').remove();
                    // According to docs, the article is in response.data
                    const news = response.data || response;

                    if (news && news.id) {
                        // Set Page Titles
                        document.title = "FDD - " + news.title;
                        $('#breadcrumb-title').text(news.title);
                        $('#breadcrumb-active').text(news.title);

                        let attachmentsHtml = '';
                        if (news.attachments_urls && news.attachments_urls.length > 0) {
                            attachmentsHtml = '<div class="attachments-area mt-50"><h5>Allegati:</h5><ul>';
                            news.attachments_urls.forEach(function (att) {
                                // The API returns objects with 'name' and 'url'
                                const name = att.name || (typeof att === 'string' ? att.split('/').pop() : 'Allegato');
                                const url = att.url || att;
                                attachmentsHtml += `<li><a href="${url}" target="_blank"><i class="fa fa-file-o"></i> ${name}</a></li>`;
                            });
                            attachmentsHtml += '</ul></div>';
                        }

                        // Try to format the date if it's ISO, otherwise use it as is
                        let dateLabel = news.created_at;
                        try {
                            if (dateLabel && (dateLabel.includes('T') || dateLabel.includes('-'))) {
                                const dateObj = new Date(dateLabel);
                                if (!isNaN(dateObj.getTime())) {
                                    dateLabel = dateObj.toLocaleString('it-IT', {
                                        day: '2-digit',
                                        month: '2-digit',
                                        year: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    });
                                }
                            }
                        } catch (e) {
                            console.error("Date formatting error:", e);
                        }

                        let imageHtml = '';
                        if (news.image_url) {
                            imageHtml = `
                                <div class="post-thumbnail mb-30 text-center">
                                    <img src="${news.image_url}" alt="${news.title}" style="max-height: 500px; width: auto;">
                                </div>
                            `;
                        }

                        const detailHtml = `
                            <div class="post-content">
                                <h4 class="post-title">${news.title || ''}</h4>
                                <div class="post-meta mb-30">
                                    <a href="#"><i class="fa fa-clock-o" aria-hidden="true"></i> ${dateLabel || ''}</a>
                                    <a href="#"><i class="fa fa-user" aria-hidden="true"></i> Team FDD</a>
                                </div>
                                ${imageHtml}
                                <div class="post-excerpt mb-30">
                                    <strong>${news.excerpt || ''}</strong>
                                </div>
                                <div class="post-body">
                                    ${news.body || ''}
                                </div>
                                ${attachmentsHtml}
                            </div>
                        `;
                        $('#news-detail-container').html(detailHtml);
                    } else {
                        $('#news-detail-container').html('<div class="col-12 text-center"><p>Articolo non trovato.</p><a href="news.html" class="btn alazea-btn">Torna alle News</a></div>');
                    }
                },
                error: function (xhr, status, error) {
                    $('#loading-spinner').remove();
                    if (xhr.status === 404) {
                        $('#news-detail-container').html('<div class="col-12 text-center"><p class="text-danger">News non trovata</p><a href="news.html" class="btn alazea-btn">Torna alle News</a></div>');
                    } else {
                        $('#news-detail-container').html('<div class="col-12 text-center"><p class="text-danger">Errore nel caricamento dell\'articolo. Riprova più tardi.</p><a href="news.html" class="btn alazea-btn">Torna alle News</a></div>');
                    }
                    console.error("API Error:", error);
                }
            });
        });
    </script>
</body>

</html>